# -*- coding: utf-8 -*-

from tgext.admin.config import AdminConfig, CrudRestControllerConfig
from sprox.formbase import AddRecordForm, EditableForm
from formencode import Schema
from formencode.validators import FieldsMatch
from tw.forms import *


from sprox.tablebase import TableBase
from sprox.fillerbase import TableFiller
from sprox.fillerbase import EditFormFiller



from proyectosaptg.model import *

from tg import expose, flash, require, url, request, redirect
from tg.decorators import without_trailing_slash, with_trailing_slash
from tg.decorators import paginate
from tgext.crud.decorators import registered_validate, register_validators, catch_errors



from tg import tmpl_context

from tgext.crud.controller import CrudRestController


from sprox.widgets import PropertyMultipleSelectField

from repoze.what import predicates
from repoze.what.predicates import not_anonymous




#importamos los controladores de nuestras entidades
from user_controlador import *
from proyecto_controlador import *
from tipo_item_controlador import *
from atributo_controlador import *
from fase_controlador import *    
from item_controlador import *        
from valores_controlador import *        
from linea_base_controlador import *        
from relacion_controlador import *        



#instancimos los controladores
class MyAdminConfig(AdminConfig):
      
    #DefaultControllerConfig    = MyCrudRestControllerConfig  


		@with_trailing_slash
		@expose('proyectosaptg.templates.index_admin')
		def index(self):
				#overrides the template for this method
				original_index_template = self.index.decoration.engines['text/html']
				new_engine = self.default_index_template.split(':')
				new_engine.extend(original_index_template[2:])
				self.index.decoration.engines['text/html'] = new_engine
				
				userid = request.identity['repoze.who.userid']
				
				print '/user id...!!!'
				print userid
				
				
				return dict(models=[model.__name__ for model in self.config.models.values()])




		user = UserCrudConfig
		proyecto = ProyectoCrudConfig
		tipoitem = TipoItemCrudConfig
		atributo = AtributoCrudConfig
		fase = FaseCrudConfig
		item = ItemCrudConfig
		valorescadena = ValoresCadenaCrudConfig
		valoresnumero = ValoresNumeroCrudConfig
		valoresfecha = ValoresFechaCrudConfig
		lineabase = LineaBaseCrudConfig
		relacion = RelacionCrudConfig

    
   